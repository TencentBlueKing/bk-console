$(".from-content #modify-info").on("click", function () { var t = $(this).attr("data-type"); if ($("#error_tip").text(""), "modify" == t) $(".editor-content").find(".from-content input").addClass("br"), $(".editor-content").find(".from-content input").removeAttr("disabled"), $(".editor-content").find(".from-content input").each(function (t) { $(this).attr("data", $(this).val()), "--" == $(this).val() && $(this).val("") }), $(".other_operate").hide(), $("#cancel-modify").show(), $(this).attr("data-type", "save"), $(this).text(gettext("保存")); else { var e = $.trim($("#chname").val()); if (!e.match(/^[\u4e00-\u9fa5a-zA-Z0-9_]{1,16}$/)) return $("#error_tip").html(gettext("中文名只能包含数字、字母、中文汉字、下划线，长度在1-16个字符")), $("#chname").focus(), !1; var o = $.trim($("#phone").val()); if (!o.match(/^\d{10,11}$/)) return $("#error_tip").text(gettext("仅支持中国大陆手机号码（11位数字）")), $("#phone").focus(), !1; var r = $.trim($("#email").val()); if (!r.match(/^[A-Za-z0-9]+([-_.][A-Za-z0-9]+)*@([A-Za-z0-9]+[-.])+[A-Za-z0-9]{2,5}$/)) return $("#error_tip").text(gettext("请输入正确的邮箱格式")), $("#email").focus(), !1; var a = $.trim($("#qq").val()); if (!a.match(/^[1-9]\d{4,}$/)) return $("#error_tip").text(gettext("仅支持合法的QQ号码")), $("#qq").focus(), !1; var i = site_url + "user_center/account/modify_user_info/"; $.post(i, { chname: e, phone: o, email: r, qq: a }, function (t) { t.result ? (window.location.reload()) : $("#error_tip").text(t.message) }, "json") } }), $(".from-content #cancel-modify").on("click", function () { $("#error_tip").text(""), $(".editor-content").find(".from-content input").removeClass("br"), $(".editor-content").find(".from-content input").attr("disabled", !0), $(".editor-content").find(".from-content input").each(function (t) { $(this).val($(this).attr("data")) }), $(".other_operate").show(), $("#cancel-modify").hide(), $("#modify-info").attr("data-type", "modify"), $("#modify-info").text(gettext("修改个人信息")) }); var change_password_html = ["<div>", '    <label class="password_label" style="width:80px;">' + gettext("新密码：") + '<span style="color:red">*</span> </label>', "    \x3c!-- 防止Firefox下密码自动填充 --\x3e", '    <input type="text" style="display:none">', '    <input type="password" style="display:none">', '    <input class="form-control password_input" style="width:250px" id="id_password1" name="password1"  type="text" onfocus="this.type=\'password\'">', '    <span style="color:red;display:none" class="error_tip ml10">' + gettext("必填") + "</span>", '    <p style="margin: 10px 0 10px 83px;" class="tip" id="pattern_tip">' + gettext("请输入密码，长度在8-20个字符，可支持数字、字母以及!@#$%^*()_-+=，必须保证密码包含大小写字母和数字") + "</p>", "</div>", '<div style="margin-bottom:10px;">', '    <label class="password_label" style="width:80px;">' + gettext("确认密码：") + '<span style="color:red">*</span> </label>', '    <input class="form-control password_input" style="width:250px" id="id_password2" name="password2" placeholder="' + gettext("再次输入密码") + '"  type="text" onfocus="this.type=\'password\'">', '    <span style="color:red;display:none" class="error_tip ml10">' + gettext("必填") + "</span>", "</div>", '<span id="password_tip" style="color:red;margin-left: 83px;"></span>'].join(""); $("#change-password").on("click", function () { $(".error_tip").hide(), $(".password_input").val(""), $("#password_tip").text(""), art.dialog({ id: "bktips", title: gettext("修改密码"), lock: !0, width: 500, content: change_password_html, cancelVal: gettext("取消"), cancel: function () { }, okVal: gettext("修改密码"), ok: function () { var t = !0; if ($(".error_tip").hide(), $("#pattern_tip").css("color", "#887b7b"), $(".password_input").each(function () { var e = $.trim($(this).val()); return e ? e.match(/^(?=.*\d)(?=.*[a-z])(?=.*[A-Z])[A-Za-z0-9!@#\$%\^\*\(\)-_\+=]{8,20}$/) || "password1" != $(this).attr("name") ? void 0 : ($("#pattern_tip").css("color", "red"), $(this).focus(), t = !1, !1) : ($(this).next(".error_tip").show(), $(this).focus(), t = !1, !1) }), !t) return !1; var e = $.trim($("#id_password1").val().trim()), o = $.trim($("#id_password2").val().trim()); if (e != o && ($("#password_tip").text(gettext("两次输入的新密码不一致")), t = !1), !t) return !1; var r = site_url + "user_center/account/change_password/", a = !0; if ($.ajax({ type: "POST", url: r, data: { new_password1: e, new_password2: o }, success: function (t) { t.result || ($("#password_tip").text(t.message), a = !1) }, dataType: "json", async: !1 }), !a) return !1; art.dialog({ width: 300, icon: "succeed", lock: !0, content: gettext("密码修改成功") }).time(2), setTimeout(function () { window.parent.BLUEKING.base.logout_handler() }, 2100) } }) });