var TEMP = {}, BLUEKING = {}, tool_apps = ["market", "app_statistics", "user_center", "bk_iam", "bk_user_manage"]; BLUEKING.CONFIG = { desk: 1, dockPos: "left", appXY: "x", appSize: "m", appButtonTop: 80, appButtonLeft: 20, windowIndexid: 1e4, windowMinWidth: 315, windowMinHeight: 200, wallpaperState: 1, wallpaper: "", wallpaperType: "", wallpaperWidth: 0, wallpaperHeight: 0 }, BLUEKING.VAR = { zoomLevel: 1, isAppMoving: !1, dock: [], desk1: [], desk2: [], desk3: [], desk4: [], desk5: [], folder: [] }, BLUEKING.DOCKTOOL_VAR = { startmenu_state: !1, tool_start: !1, appearancement_state: !1, tool_appearance: !1, helpsment_state: !1, tool_helps: !1 }, $.ajaxSetup({ cache: !1, statusCode: { 401: function (e) { window.parent.location.reload()},402:function(e){var t=e.responseText;ajax_content='<iframe name="access_control_iframe" frameborder="0" src="'+t+'"></iframe>',art.dialog({id:"bktips"}).close(),art.dialog({id:"bktips",title:gettext("提示"),lock:!0,content:ajax_content})},500:function(e,t){art.dialog({id:"bktips"}).close(),art.dialog({id:"bktips",title:gettext("提示"),lock:!0,content:gettext("系统出现异常：")+t+"---"+e.status+"===="})}}}),BLUEKING.corefunc=function(){return{get_urlprefix:function(){return"/console/"},get_dev_urlprefix:function(){return"/app/list/"},get_analysis_urlprefix:function(){return"/console/analysis/"},get_bk_host:function(){return window.location.host},get_bk_url:function(){var e=window.location.host;return window.location.protocol+"//"+e+BLUEKING.corefunc.get_urlprefix()},get_dev_url:function(){if(bk_paas3_url)return bk_paas3_url;var e=window.location.host;return window.location.protocol+"//"+e+BLUEKING.corefunc.get_dev_urlprefix()},get_app_url:function(e){var t=window.location.host;return window.location.protocol+"//"+t+"/o/"+e},get_logout_urlprefix:function(){return BLUEKING.corefunc.get_urlprefix()+"accounts/logout/"},get_account_profile_urlprefix:function(){return"/accounts/profile/"},get_external_links:function(e){var t=BLUEKING.corefunc.get_dev_urlprefix();switch(e){case"community_forums":t="https://bk.tencent.com/s-mart/community/";break;case"video_course":t="https://ke.qq.com/course/154064#tuin=218e4713";break;case"magicbox":t="https://magicbox.bk.tencent.com/";break;case"bk_os":t="https://bk.tencent.com/";break;case"bk_service_agreement":t="https://bk.tencent.com/info/#laws"}return t}}}();var urlPrefix=BLUEKING.corefunc.get_urlprefix(),staticUrl=BLUEKING.corefunc.get_urlprefix()+"static/",staticVersion="0.0.1";if(BLUEKING.toolfunc=function(){return{app_logo_error_handle:function(){var e=event.srcElement;e.src=staticUrl+"img/app_logo/default.png",e.onerror=null},xssCheck:function(e){if(!e)return e;var t=e.toLowerCase();return-1!=t.indexOf("javascript:")||-1!=t.indexOf("vbscript:")||-1!=t.indexOf("data:")||-1!=t.indexOf("scrip:")?"":(e.replace(/[&<">'](?:(amp|lt|quot|gt|#39|nbsp|#\d+);)?/g,function(e,t){return t?e:{"<":"&lt;","&":"&amp;",'"':"&quot;",">":"&gt;","'":"&#39;"}[e]}),e)}}}(),BLUEKING.api=function(){return{is_tool_app:function(e){return-1!=$.inArray(e,tool_apps)},open_app_by_desk:function(e,t){"bk_cc"==e&&(e="bk_cmdb");var r=BLUEKING.api.get_app_msg(e);if("E100"==r.error)ZENG.msgbox.show(gettext("应用不存在！"),5,3e3);else if("E501"==r.error||"E502"==r.error||"E503"==r.error)ZENG.msgbox.show(gettext("应用加载失败，请重试"),5,3e3);else if("E400"==r.error)ZENG.msgbox.show(gettext("您没有操作该应用的权限！"),5,3e3);else if("E200"==r.error)ZENG.msgbox.show(gettext("应用已下架！"),5,3e3);else if("E300"==r.error)ZENG.msgbox.show(gettext("应用正在开发中！"),5,3e3);else{var o=r.appid;o?isnotadd=0:(o=e,isnotadd=1),BLUEKING.window.create(o,t,"",isnotadd)}},open_app_by_other:function(e,t,r){if(BLUEKING.api.is_tool_app(e))switch(e){case"market":BLUEKING.window.create_market(t);break;case"app_statistics":BLUEKING.window.create_app_statistics(t);break;case"user_center":BLUEKING.window.create_user_center(t);break;case"bk_iam":BLUEKING.window.create_bk_iam(t);break;case"bk_user_manage":BLUEKING.window.create_bk_user_manage(t)}else{"bk_cc"==e&&(e="bk_cmdb");var o=BLUEKING.api.get_app_msg(e);if("E100"==o.error)ZENG.msgbox.show(gettext("应用不存在！"),5,3e3);else if("E501"==o.error||"E502"==o.error||"E503"==o.error)ZENG.msgbox.show(gettext("应用加载失败，请重试"),5,3e3);else if("E400"==o.error)ZENG.msgbox.show(gettext("您没有操作该应用的权限！"),5,3e3);else if("E200"==o.error)ZENG.msgbox.show(gettext("应用已下架！"),5,3e3);else if("E300"==o.error)ZENG.msgbox.show(gettext("应用正在开发中！"),5,3e3);else{var a=o.appid;a?isnotadd=0:(a=e,isnotadd=1),1==r?BLUEKING.window.create(a,t,e,isnotadd):BLUEKING.window.create(a,t,"",isnotadd)}}},is_user_added_app:function(e){var t=!1,r="",o="应用不存在！";return $.ajax({url:urlPrefix+"is_user_added_app/"+e+"/",success:function(e){null!=e?e.error?(t=!1,r="","E100"==e.error?o=gettext("应用不存在！"):"E501"==e.error||"E502"==e.error||"E503"==e.error?o=gettext("应用加载失败，请重试"):"E400"==e.error?o=gettext("您没有操作该应用的权限！"):"E200"==e.error?o=gettext("应用已下架！"):"E300"==e.error&&(o=gettext("应用正在开发中！"))):(t=e.result,r=e.realappid):(t=!1,r="",o=gettext("应用不存在！"))},type:"POST",async:!1}),[t,r,o]},get_app_msg:function(e){var t="";return $.ajax({url:urlPrefix+"get_my_app_by_code/"+e+"/",data:{desk:BLUEKING.CONFIG.desk},success:function(e){t=null!=e?e.error?{error:e.error}:{appid:e.appid,realappid:e.realappid,url:e.url,width:e.width,height:e.height,is_add:e.return_code}:{error:"E100"}},type:"GET",async:!1}),t},app_record_by_user:function(e){$.ajax({type:"POST",url:BLUEKING.corefunc.get_analysis_urlprefix()+"app_record_by_user/"+e+"/",success:function(e){}})}}}(),void 0===Poly9)var Poly9={};Poly9.URLParser=function(e){this._fields={Username:4,Password:5,Port:7,Protocol:2,Host:6,Pathname:8,URL:0,Querystring:9,Fragment:10},this._values={},this._regex=null,this.version=.1,this._regex=/^((\w+):\/\/)?((\w+):?(\w+)?@)?([^\/\?:]+):?(\d+)?(\/?[^\?#]+)?\??([^#]+)?#?(\w*)/;for(var t in this._fields)this["get"+t]=this._makeGetter(t);void 0!==e&&this._parse(e)},Poly9.URLParser.prototype.setURL=function(e){this._parse(e)},Poly9.URLParser.prototype._initValues=function(){for(var e in this._fields)this._values[e]=""},Poly9.URLParser.prototype._parse=function(e){this._initValues();var t=this._regex.exec(e);if(!t)throw"DPURLParser::_parse -> Invalid URL";for(var r in this._fields)void 0!==t[this._fields[r]]&&(this._values[r]=t[this._fields[r]])},Poly9.URLParser.prototype._makeGetter=function(e){return function(){return this._values[e]}},window.addEventListener("message",function(e){if(e.data)try{var t=JSON.parse(e.data);switch(t.action){case"open_other_app":BLUEKING.api.open_app_by_other(t.app_code,t.app_url,t.refresh_tips)}}catch(e){}});