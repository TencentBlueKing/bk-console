BLUEKING.marketBase = (function () { return { init: function () { BLUEKING.marketSearchbox.init(); BLUEKING.marketSidebar.init(); BLUEKING.marketApp.init(); BLUEKING.marketBase.run() }, run: function () { var app_id = 0, keyword = "", search_str = window.location.search, params = search_str.substring(1).split("&"); for (var i = 0; i < params.length; i++) { var param = params[i].split("="); if (param[0] == "id") { app_id = parseInt(params[i].replace("id=", "")) } if (param[0] == "searchkey") { keyword = params[i].replace("searchkey=", "") } } if (keyword != '') { $("#search_button").click() } else if (app_id != 0) { BLUEKING.marketApp.get_all_app_on_background(); $('#detailIframe').show() } else { $('.all').click() } }, init_app_detail: function () { $(parent.document).find('#detailIframe').show(); var clip = new ClipboardJS("#copy_appurl", { text: function (trigger) { return BLUEKING.corefunc.get_bk_url() + '?app=' + $('#copy_appurl').attr('app_code') } }); clip.on('success', function () { art.dialog({ title: gettext("温馨提示"), width: 340, icon: 'succeed', lock: false, fixed: true, content: gettext('复制成功！您可以使用ctrl+v进行粘贴！'), okVal: gettext("关闭"), time: 3 }).time(2) }); $('.btn-add').click(function () { var appid = $(this).attr('app_id'); try { window.top.BLUEKING.app.add(appid, function () { window.top.BLUEKING.app.get(); location.reload() }) } catch (err) { console.log(err) } }); $('.btn-run').click(function () { try { if ($(this).attr('app_id') == '') { window.top.BLUEKING.api.open_app_by_other($(this).attr('app_code')) } else { if ($(this).attr('app_type') == 'app') { window.top.BLUEKING.window.create($(this).attr('app_id')) } else { window.top.BLUEKING.widget.create($(this).attr('app_id')) } } } catch (err) { console.log(err) } }); $('.grade-box ul li').click(function () { var num = $(this).attr('num'); if (!isNaN(num) && /^[1-5]$/.test(num)) { $.ajax({ type: 'POST', url: urlPrefix + 'update_app_star/' + $("#app_id").val() + '/', data: 'star_num=' + num, success: function (result) { msg = result.result; if (msg == 1) { ZENG.msgbox.show(gettext("打分成功！"), 4, 2000); window.location.reload() } else if (msg == 2) { ZENG.msgbox.show(gettext("你已经打过分了！"), 1, 2000) } else { ZENG.msgbox.show(gettext("打分出错！"), 1, 2000) } } }) } }) }, } })();